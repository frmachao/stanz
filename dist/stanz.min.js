/*!
* stanz v7.0.0
* https://github.com/kirakiray/stanz
* 
* (c) 2018-2021 YAO
* Released under the MIT License.
*/((t,e)=>{"use strict";"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(e):t.stanz=e()})(this,()=>{"use strict";const t=()=>Math.random().toString(32).substr(2);var e=Object.prototype.toString,r=t=>e.call(t).toLowerCase().replace(/(\[object )|(])/g,"");const s=Object.defineProperties,o=Object.getOwnPropertyDescriptor,n=t=>t instanceof d,i=null!==document.currentScript.getAttribute("debug"),a=(()=>{if(i){let e=new Map;return(r,s)=>{s||(s=t());let o=e.get(s);clearTimeout(o),e.set(s,setTimeout(()=>{r(),e.delete(s)}))}}let e=new Map,r=t=>Promise.resolve().then(()=>t());"object"==typeof process&&process.nextTick&&(r=process.nextTick);let s=!1;return(o,n)=>{n||(n=t()),e.set(n,{key:n,fun:o}),s||(s=!0,r(()=>{e.size&&e.forEach(({key:t,fun:r})=>{try{r()}catch(t){console.error(t)}e.delete(t)}),e.clear(),s=!1}))}})(),c=(t,e)=>{Object.keys(e).forEach(r=>{let{get:s,set:n,value:i}=o(e,r);i?t.hasOwnProperty(r)?t[r]=i:Object.defineProperty(t,r,{value:i}):Object.defineProperty(t,r,{get:s,set:n})})},l=(Date.now(),Symbol("self")),h=Symbol("watchs"),u=Symbol("can_update"),p=new Set(["root","sub","revoke"]),f=(t,e)=>{t[h].forEach(t=>t(e)),t.owner.forEach(t=>f(t,e))};class d{constructor(e,r){let n;e.get?(n=new Proxy(this,{get:e.get,ownKeys:e.ownKeys,getOwnPropertyDescriptor:e.getOwnPropertyDescriptor,set:y.set}),delete e.get,delete e.ownKeys,delete e.getOwnPropertyDescriptor):n=new Proxy(this,y);let i=r;s(this,{[l]:{value:this},xid:{value:"x_"+t()},_xtatus:{get:()=>i,set(t){if(!p.has(t))throw{target:n,desc:`xtatus not allowed to be set ${t}`};const e=this.owner.size;if("revoke"===t&&e)throw{target:n,desc:"the owner is not empty"};if("revoke"===i&&"revoke"!==t)e||g(this);else if("sub"===i&&"root"===t)throw{target:n,desc:"cannot modify sub to root"};i=t}},owner:{value:new Set},length:{configurable:!0,writable:!0,value:0},[h]:{value:new Map},[u]:{writable:!0,value:0}});let a=-1;return Object.keys(e).forEach(t=>{let r=o(e,t),{value:n,get:i,set:c}=r;"get"!==t&&(/\D/.test(t)||(t=parseInt(t))>a&&(a=t),i||c?s(this,{[t]:r}):this.setData(t,n))}),a>-1&&(this.length=a+1),this[u]=1,n}watch(e){const r="e_"+t();return this[h].set(r,e),r}unwatch(t){return this[h].delete(t)}setData(t,e){if(/^_/.test(t))return this.hasOwnProperty(t)?Reflect.set(this,t,e):s(this,{[t]:{writable:!0,configurable:!0,value:e}}),!0;let o=r(e);"array"!=o&&"object"!=o||(e=b(e,"sub")).owner.add(this);const n=this[t];if(n===e)return!0;let i=Reflect.set(this,t,e);return this[u]&&f(this,{xid:this.xid,name:"setData",args:[t,e]}),w(n,this),i}delete(t){if(/^_/.test(t)||"symbol"==typeof t)return Reflect.deleteProperty(this,t);if(!t)return!1;const e=this[l];let r=e[t];w(r,e);let s=Reflect.deleteProperty(e,t);return f(this,{xid:this.xid,name:"delete",args:[t]}),s}}const y={set:(t,e,r,s)=>"symbol"==typeof e?Reflect.set(t,e,r,s):t.setData(e,r),deleteProperty:function(t,e){return t.delete(e)}},w=(t,e)=>{if(!n(t))return;const{owner:r}=t;r.delete(e),r.size||(t._xtatus="revoke",Object.values(t).forEach(e=>{w(e,t[l])}))},g=t=>{"revoke"===t._xtatus&&Object.values(t).forEach(e=>{n(e)&&(g(e),e.owner.add(t),e._xtatus="sub")})},b=(t,e)=>n(t)?(t._xtatus=e,t):new d(t,e);c(d.prototype,{seek(t){let e=[];if(!(t=>r(t).search("function")>-1)(t)){let e=new Function(`with(this){return ${t}}`);t=(t=>{try{return e.call(t,t)}catch(t){}})}return t.call(this,this)&&e.push(this),Object.values(this).forEach(r=>{n(r)&&e.push(...r.seek(t))}),e},watchTick(t){return this.watch((t=>{let e=[];const r=s=>{e.push(s),a(()=>{t(e),e.length=0},r)};return r})(t))},watchUntil(t){if(/[^=]=[^=]/.test(t))throw"cannot use single =";return new Promise(e=>{let r=new Function(`\n        try{with(this){\n            return ${t}\n        }}catch(e){}`).bind(this);const s=this.watch(()=>{let t=r();t&&(this.unwatch(s),e(t))})})},toJSON(){let t={},e=!0,r=0;Object.keys(this).forEach(s=>{let o=this[s];/\D/.test(s)?e=!1:(s=parseInt(s))>r&&(r=s),n(o)&&(o=o.toJSON()),t[s]=o}),e&&(t.length=r+1,t=Array.from(t));const o=this.xid;return s(t,{xid:{get:()=>o}}),t},toString(){return JSON.stringify(this.toJSON())}}),["concat","every","filter","find","findIndex","forEach","map","slice","some","indexOf","lastIndexOf","includes","join"].forEach(t=>{let e=Array.prototype[t];e&&s(d.prototype,{[t]:{value:e}})});const x=Array.prototype.splice;c(d.prototype,{splice(t,e,...s){let o=this[l];s=s.map(t=>{let e=r(t);return"array"!=e&&"object"!=e||(t=b(t,"sub")).owner.add(o),t});let n=x.call(o,t,e,...s);return n.forEach(t=>w(t,o)),f(this,{xid:this.xid,name:"splice",args:[t,e,...s]}),n},unshift(...t){return this.splice(0,0,...t),this.length},push(...t){return this.splice(this.length,0,...t),this.length},shift(){return this.splice(0,1)[0]},pop(){return this.splice(this.length-1,1)[0]}}),["sort","reverse"].forEach(t=>{const e=Array.prototype[t];e&&s(d.prototype,{[t]:{value(...r){let s=e.apply(this[l],r);return f(this,{xid:this.xid,name:t}),s}}})});const v=t=>b(t,"root");return Object.assign(v,{version:"7.0.0",v:7e6,isxdata:n}),v});