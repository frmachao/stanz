/*!
* stanz v7.0.0
* https://github.com/kirakiray/stanz
* 
* (c) 2018-2021 YAO
* Released under the MIT License.
*/((e,t)=>{"use strict";"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define(t):e.stanz=t()})(this,()=>{"use strict";const e=()=>Math.random().toString(32).substr(2);var t=Object.prototype.toString,r=e=>t.call(e).toLowerCase().replace(/(\[object )|(])/g,"");const s=Object.defineProperties,o=Object.getOwnPropertyDescriptor,n=e=>e instanceof d,i=null!==document.currentScript.getAttribute("debug"),a=(()=>{if(i){let t=new Map;return(r,s)=>{s||(s=e());let o=t.get(s);clearTimeout(o),t.set(s,setTimeout(()=>{r(),t.delete(s)}))}}let t=new Map,r=e=>Promise.resolve().then(()=>e());"object"==typeof process&&process.nextTick&&(r=process.nextTick);let s=!1;return(o,n)=>{n||(n=e()),t.set(n,{key:n,fun:o}),s||(s=!0,r(()=>{t.size&&t.forEach(({key:e,fun:r})=>{try{r()}catch(e){console.error(e)}t.delete(e)}),t.clear(),s=!1}))}})(),c=(e,t)=>{Object.keys(t).forEach(r=>{let{get:s,set:n,value:i}=o(t,r);i?e.hasOwnProperty(r)?e[r]=i:Object.defineProperty(e,r,{value:i}):Object.defineProperty(e,r,{get:s,set:n})})},l=(Date.now(),Symbol("self")),h=Symbol("watchs"),u=Symbol("can_update"),p=new Set(["root","sub","revoke"]),f=(e,t)=>{e[h].forEach(e=>e(t)),e.owner&&e.owner.forEach(e=>f(e,t))};class d{constructor(t,r){let n;t.get?(n=new Proxy(this,{get:t.get,ownKeys:t.ownKeys,getOwnPropertyDescriptor:t.getOwnPropertyDescriptor,set:y.set}),delete t.get,delete t.ownKeys,delete t.getOwnPropertyDescriptor):n=new Proxy(this,y);let i=r;s(this,{[l]:{value:this},xid:{value:"x_"+e()},_xtatus:{get:()=>i,set(e){if(!p.has(e))throw{target:n,desc:`xtatus not allowed to be set ${e}`};const t=this.owner.size;if("revoke"===e&&t)throw{target:n,desc:"the owner is not empty"};if("revoke"===i&&"revoke"!==e)t||g(this);else if("sub"===i&&"root"===e)throw{target:n,desc:"cannot modify sub to root"};i=e}},owner:{writable:!0,value:new Set},length:{configurable:!0,writable:!0,value:0},[h]:{value:new Map},[u]:{writable:!0,value:0}});let a=-1;return Object.keys(t).forEach(e=>{let r=o(t,e),{value:i,get:c,set:l}=r;"get"!==e&&(/\D/.test(e)||(e=parseInt(e))>a&&(a=e),c||l?s(this,{[e]:r}):n[e]=i)}),a>-1&&(this.length=a+1),this[u]=1,n}watch(t){const r="e_"+e();return this[h].set(r,t),r}unwatch(e){return this[h].delete(e)}setData(e,t){let s=r(t);"array"!=s&&"object"!=s||(t=b(t,"sub")).owner.add(this);const o=this[e];if(o===t)return!0;let n=Reflect.set(this,e,t);return this[u]&&f(this,{xid:this.xid,name:"setData",args:[e,t]}),w(o,this),n}delete(e){if(/^_/.test(e)||"symbol"==typeof e)return Reflect.deleteProperty(this,e);if(!e)return!1;const t=this[l];let r=t[e];w(r,t);let s=Reflect.deleteProperty(t,e);return f(this,{xid:this.xid,name:"delete",args:[e]}),s}}const y={set:(e,t,r,o)=>"symbol"==typeof t?Reflect.set(e,t,r,o):/^_/.test(t)?(e.hasOwnProperty(t)?Reflect.set(e,t,r,o):s(e,{[t]:{writable:!0,configurable:!0,value:r}}),!0):e.setData(t,r),deleteProperty:function(e,t){return e.delete(t)}},w=(e,t)=>{if(!n(e))return;const{owner:r}=e;r.delete(t),r.size||(e._xtatus="revoke",Object.values(e).forEach(t=>{w(t,e[l])}))},g=e=>{"revoke"===e._xtatus&&Object.values(e).forEach(t=>{n(t)&&(g(t),t.owner.add(e),t._xtatus="sub")})},b=(e,t="root")=>n(e)?(e._xtatus=t,e):new d(e,t);c(d.prototype,{seek(e){let t=[];if(!(e=>r(e).search("function")>-1)(e)){let t=new Function(`with(this){return ${e}}`);e=(e=>{try{return t.call(e,e)}catch(e){}})}return e.call(this,this)&&t.push(this),Object.values(this).forEach(r=>{n(r)&&t.push(...r.seek(e))}),t},watchTick(e){return this.watch((e=>{let t=[];const r=s=>{t.push(s),a(()=>{e(t),t.length=0},r)};return r})(e))},watchUntil(e){if(/[^=]=[^=]/.test(e))throw"cannot use single =";return new Promise(t=>{let r=new Function(`\n        try{with(this){\n            return ${e}\n        }}catch(e){}`).bind(this);const s=this.watch(()=>{let e=r();e&&(this.unwatch(s),t(e))})})},toJSON(){let e={},t=!0,r=0;Object.keys(this).forEach(s=>{let o=this[s];/\D/.test(s)?t=!1:(s=parseInt(s))>r&&(r=s),n(o)&&(o=o.toJSON()),e[s]=o}),t&&(e.length=r+1,e=Array.from(e));const o=this.xid;return s(e,{xid:{get:()=>o}}),e},toString(){return JSON.stringify(this.toJSON())}}),["concat","every","filter","find","findIndex","forEach","map","slice","some","indexOf","lastIndexOf","includes","join"].forEach(e=>{let t=Array.prototype[e];t&&s(d.prototype,{[e]:{value:t}})});const x=Array.prototype.splice;c(d.prototype,{splice(e,t,...s){let o=this[l];s=s.map(e=>{let t=r(e);return"array"!=t&&"object"!=t||(e=b(e,"sub")).owner.add(o),e});let n=x.call(o,e,t,...s);return n.forEach(e=>w(e,o)),f(this,{xid:this.xid,name:"splice",args:[e,t,...s]}),n},unshift(...e){return this.splice(0,0,...e),this.length},push(...e){return this.splice(this.length,0,...e),this.length},shift(){return this.splice(0,1)[0]},pop(){return this.splice(this.length-1,1)[0]}}),["sort","reverse"].forEach(e=>{const t=Array.prototype[e];t&&s(d.prototype,{[e]:{value(...r){let s=t.apply(this[l],r);return f(this,{xid:this.xid,name:e}),s}}})});const v=e=>b(e,"root");return Object.assign(v,{version:"7.0.0",v:7e6,isxdata:n}),v});