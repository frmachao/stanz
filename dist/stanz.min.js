/*!
* stanz v7.0.0
* https://github.com/kirakiray/stanz
* 
* (c) 2018-2021 YAO
* Released under the MIT License.
*/((e,t)=>{"use strict";"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define(t):e.stanz=t()})(this,()=>{"use strict";const e=()=>Math.random().toString(32).substr(2);var t=Object.prototype.toString,r=e=>t.call(e).toLowerCase().replace(/(\[object )|(])/g,"");const s=Object.defineProperties,n=Object.getOwnPropertyDescriptor,i=e=>e instanceof f,o=null!==document.currentScript.getAttribute("debug"),l=(()=>{if(o){let t=new Map;return(r,s)=>{s||(s=e());let n=t.get(s);clearTimeout(n),t.set(s,setTimeout(()=>{r(),t.delete(s)}))}}let t=new Map,r=e=>Promise.resolve().then(()=>e());"object"==typeof process&&process.nextTick&&(r=process.nextTick);let s=!1;return(n,i)=>{i||(i=e()),t.set(i,{key:i,fun:n}),s||(s=!0,r(()=>{t.size&&t.forEach(({key:e,fun:r})=>{try{r()}catch(e){console.error(e)}t.delete(e)}),t.clear(),s=!1}))}})(),c=(e,t)=>{Object.keys(t).forEach(r=>{let{get:s,set:i,value:o}=n(t,r);o?e.hasOwnProperty(r)?e[r]=o:Object.defineProperty(e,r,{value:o}):Object.defineProperty(e,r,{get:s,set:i})})},a=(Date.now(),Symbol("self")),h=Symbol("watchs"),u=Symbol("can_update"),p=(e,t)=>{e[h].forEach(e=>e(t)),e.owner.forEach(e=>p(e,t))};class f{constructor(t){if(i(t))return t;let r;t.get?(r=new Proxy(this,{get:t.get,ownKeys:t.ownKeys,getOwnPropertyDescriptor:t.getOwnPropertyDescriptor,set:d.set}),delete t.get,delete t.ownKeys,delete t.getOwnPropertyDescriptor):r=new Proxy(this,d),s(this,{[a]:{value:this},xid:{value:"x_"+e()},owner:{value:new Set},length:{configurable:!0,writable:!0,value:0},[h]:{value:new Map},[u]:{writable:!0,value:0}});let o=-1;return Object.keys(t).forEach(e=>{let r=n(t,e),{value:i,get:l,set:c}=r;"get"!==e&&(/\D/.test(e)||(e=parseInt(e))>o&&(o=e),l||c?s(this,{[e]:r}):this.setData(e,i))}),o>-1&&(this.length=o+1),this[u]=1,r}watch(t){const r="e_"+e();return this[h].set(r,t),r}unwatch(e){return this[h].delete(e)}setData(e,t){if(/^_/.test(e))return s(this,{[e]:{writable:!0,configurable:!0,value:t}}),!0;let n=r(t);"array"!=n&&"object"!=n||(t=new f(t,this)).owner.add(this);const o=this[e];let l=Reflect.set(this,e,t);return this[u]&&p(this,{xid:this.xid,name:"setData",args:[e,t]}),i(o)&&o.owner.delete(this),l}delete(e){if(/^_/.test(e)||"symbol"==typeof e)return Reflect.deleteProperty(this,e);if(!e)return!1;const t=this[a];let r=t[e];i(r)&&r.owner.delete(t);let s=Reflect.deleteProperty(t,e);return p(this,{xid:this.xid,name:"delete",args:[e]}),s}}const d={set:(e,t,r,s)=>"symbol"==typeof t?Reflect.set(e,t,r,s):e.setData(t,r),deleteProperty:function(e,t){return e.delete(t)}};c(f.prototype,{seek(e){let t=[];if(!(e=>r(e).search("function")>-1)(e)){let t=new Function(`with(this){return ${e}}`);e=(e=>{try{return t.call(e,e)}catch(e){}})}return e.call(this,this)&&t.push(this),Object.values(this).forEach(r=>{i(r)&&t.push(...r.seek(e))}),t},watchTick(e){return this.watch((e=>{let t=[];const r=s=>{t.push(s),l(()=>{e(t),t.length=0},r)};return r})(e))},watchUntil(e){if(/[^=]=[^=]/.test(e))throw"cannot use single =";return new Promise(t=>{let r=new Function(`\n        try{with(this){\n            return ${e}\n        }}catch(e){}`).bind(this);const s=this.watch(()=>{let e=r();e&&(this.unwatch(s),t(e))})})},toJSON(){let e={},t=!0,r=0;Object.keys(this).forEach(s=>{let n=this[s];/\D/.test(s)?t=!1:(s=parseInt(s))>r&&(r=s),i(n)&&(n=n.toJSON()),e[s]=n}),t&&(e.length=r+1,e=Array.from(e));const n=this.xid;return s(e,{xid:{get:()=>n}}),e},toString(){return JSON.stringify(this.toJSON())}}),["concat","every","filter","find","findIndex","forEach","map","slice","some","indexOf","lastIndexOf","includes","join"].forEach(e=>{let t=Array.prototype[e];t&&s(f.prototype,{[e]:{value:t}})});const y=Array.prototype.splice;c(f.prototype,{splice(e,t,...s){let n=this[a];s=s.map(e=>{let t=r(e);return"array"!=t&&"object"!=t||(e=new f(e)).owner.add(n),e});let o=y.call(n,e,t,...s);return o.forEach(e=>i(e)&&e.owner.delete(n)),p(this,{xid:this.xid,name:"splice",args:[e,t,...s]}),o},unshift(...e){return this.splice(0,0,...e),this.length},push(...e){return this.splice(this.length,0,...e),this.length},shift(){return this.splice(0,1)[0]},pop(){return this.splice(this.length-1,1)[0]}}),["sort","reverse"].forEach(e=>{const t=Array.prototype[e];t&&s(f.prototype,{[e]:{value(...r){let s=t.apply(this[a],r);return p(this,{xid:this.xid,name:e}),s}}})});const w=e=>(e=>new f(e))(e);return Object.assign(w,{version:"7.0.0",v:7e6,isxdata:i}),w});