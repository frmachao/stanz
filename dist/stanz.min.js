/*!
* stanz v7.0.0
* https://github.com/kirakiray/stanz
* 
* (c) 2018-2021 YAO
* Released under the MIT License.
*/((t,e)=>{"use strict";"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(e):t.stanz=e()})(this,()=>{"use strict";const t=()=>Math.random().toString(32).substr(2);var e=Object.prototype.toString,r=t=>e.call(t).toLowerCase().replace(/(\[object )|(])/g,"");const s=Object.defineProperties,o=Object.getOwnPropertyDescriptor,i=t=>t instanceof w,n=null!==document.currentScript.getAttribute("debug"),a=(()=>{if(n){let e=new Map;return(r,s)=>{s||(s=t());let o=e.get(s);clearTimeout(o),e.set(s,setTimeout(()=>{r(),e.delete(s)}))}}let e=new Map,r=t=>Promise.resolve().then(()=>t());"object"==typeof process&&process.nextTick&&(r=process.nextTick);let s=!1;return(o,i)=>{i||(i=t()),e.set(i,{key:i,fun:o}),s||(s=!0,r(()=>{e.size&&e.forEach(({key:t,fun:r})=>{try{r()}catch(t){console.error(t)}e.delete(t)}),e.clear(),s=!1}))}})(),c=t=>{let e=[];const r=s=>{e.push(s),a(()=>{t(e),e.length=0},r)};return r},l=(t,e)=>{Object.keys(e).forEach(r=>{let{get:s,set:i,value:n}=o(e,r);n?t.hasOwnProperty(r)?t[r]=n:Object.defineProperty(t,r,{value:n}):Object.defineProperty(t,r,{get:s,set:i})})},h=(Date.now(),Symbol("self")),u=Symbol("proxy"),p=Symbol("watchs"),f=Symbol("can_update"),y=new Set(["root","sub","revoke"]),d=(t,e,r)=>{let s;s=e.path=r?[t[u],...r]:[t[u]],t[p].forEach(t=>t(e)),t.owner&&t.owner.forEach(t=>d(t,e,s.slice()))};class w{constructor(e,r){let i;e.get?(i=new Proxy(this,{get:e.get,ownKeys:e.ownKeys,getOwnPropertyDescriptor:e.getOwnPropertyDescriptor,set:b.set}),delete e.get,delete e.ownKeys,delete e.getOwnPropertyDescriptor):i=new Proxy(this,b);let n=r;s(this,{[h]:{value:this},[u]:{value:i},xid:{value:"x_"+t()},_xtatus:{get:()=>n,set(t){if(!y.has(t))throw{target:i,desc:`xtatus not allowed to be set ${t}`};const e=this.owner.size;if("revoke"===t&&e)throw{target:i,desc:"the owner is not empty"};if("revoke"===n&&"revoke"!==t)e||v(this);else if("sub"===n&&"root"===t)throw{target:i,desc:"cannot modify sub to root"};n=t}},owner:{writable:!0,value:new Set},length:{configurable:!0,writable:!0,value:0},[p]:{value:new Map},[f]:{writable:!0,value:0}});let a=-1;return Object.keys(e).forEach(t=>{let r=o(e,t),{value:n,get:c,set:l}=r;"get"!==t&&(/\D/.test(t)||(t=parseInt(t))>a&&(a=t),c||l?s(this,{[t]:r}):i[t]=n)}),a>-1&&(this.length=a+1),this[f]=1,i}watch(e){const r="e_"+t();return this[p].set(r,e),r}unwatch(t){return this[p].delete(t)}setData(t,e){let s=r(e);"array"!=s&&"object"!=s||(e=x(e,"sub")).owner.add(this);const o=this[t];if(o===e)return!0;let i=Reflect.set(this,t,e);return this[f]&&d(this,{xid:this.xid,name:"setData",args:[t,e]}),g(o,this),i}delete(t){if(/^_/.test(t)||"symbol"==typeof t)return Reflect.deleteProperty(this,t);if(!t)return!1;const e=this[h];let r=e[t];g(r,e);let s=Reflect.deleteProperty(e,t);return d(this,{xid:this.xid,name:"delete",args:[t]}),s}}const b={set(t,e,r,o){if("symbol"==typeof e)return Reflect.set(t,e,r,o);if(/^_/.test(e))return t.hasOwnProperty(e)?Reflect.set(t,e,r,o):s(t,{[e]:{writable:!0,configurable:!0,value:r}}),!0;try{return t.setData(e,r)}catch(t){throw{desc:`failed to set ${e}`,key:e,value:r,target:o}}},deleteProperty:function(t,e){return t.delete(e)}},g=(t,e)=>{if(!i(t))return;const{owner:r}=t;r.delete(e),r.size||(t._xtatus="revoke",Object.values(t).forEach(e=>{g(e,t[h])}))},v=t=>{"revoke"===t._xtatus&&Object.values(t).forEach(e=>{i(e)&&(v(e),e.owner.add(t),e._xtatus="sub")})},x=(t,e="root")=>i(t)?(t._xtatus=e,t):new w(t,e);l(w.prototype,{seek(t){let e=[];if(!(t=>r(t).search("function")>-1)(t)){let e=new Function(`with(this){return ${t}}`);t=(t=>{try{return e.call(t,t)}catch(t){}})}return t.call(this,this)&&e.push(this),Object.values(this).forEach(r=>{i(r)&&e.push(...r.seek(t))}),e},watchTick(t){return this.watch(c(t))},watchUntil(t){if(/[^=><]=[^=]/.test(t))throw"cannot use single =";return new Promise(e=>{let r,s=new Function(`\n        try{with(this){\n            return ${t}\n        }}catch(e){}`).bind(this);const o=this.watch(r=(()=>{let t=s();t&&(this.unwatch(o),e(t))}));r()})},watchKey(t,e){e&&Object.keys(t).forEach(e=>t[e].call(this,this[e]));let r={};return this.watch(c(e=>{Object.keys(t).forEach(s=>{let o=this[s];if(r[s]!==o)t[s].call(this,o);else if(i(o)){e.some(t=>{if(t.path[1]==r[s])return!0})&&t[s].call(this,o)}r[s]=o})}))},toJSON(){let t={},e=!0,r=0;Object.keys(this).forEach(s=>{let o=this[s];/\D/.test(s)?e=!1:(s=parseInt(s))>r&&(r=s),i(o)&&(o=o.toJSON()),t[s]=o}),e&&(t.length=r+1,t=Array.from(t));const o=this.xid;return s(t,{xid:{get:()=>o}}),t},toString(){return JSON.stringify(this.toJSON())}}),["concat","every","filter","find","findIndex","forEach","map","slice","some","indexOf","lastIndexOf","includes","join"].forEach(t=>{let e=Array.prototype[t];e&&s(w.prototype,{[t]:{value:e}})});const O=Array.prototype.splice;l(w.prototype,{splice(t,e,...s){let o=this[h];s=s.map(t=>{let e=r(t);return"array"!=e&&"object"!=e||(t=x(t,"sub")).owner.add(o),t});let i=O.call(o,t,e,...s);return i.forEach(t=>g(t,o)),d(this,{xid:this.xid,name:"splice",args:[t,e,...s]}),i},unshift(...t){return this.splice(0,0,...t),this.length},push(...t){return this.splice(this.length,0,...t),this.length},shift(){return this.splice(0,1)[0]},pop(){return this.splice(this.length-1,1)[0]}}),["sort","reverse"].forEach(t=>{const e=Array.prototype[t];e&&s(w.prototype,{[t]:{value(...r){let s=e.apply(this[h],r);return d(this,{xid:this.xid,name:t}),s}}})});const m=t=>x(t,"root");return Object.assign(m,{version:"7.0.0",v:7e6,isxdata:i}),m});